

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=dark>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/Blogs/warhammer.png">
  <link rel="icon" href="/Blogs/warhammer.png">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="唐浩天">
  <meta name="keywords" content="">
  
    <meta name="description" content="简介SPI是串行外设接口（Serial Peripheral Interface）的缩写，是美国摩托罗拉公司（Motorola）最先推出的一种同步串行传输规范，也是一种单片机外设芯片串行扩展接口，是一种高速、全双工、同步通信总线，所以可以在同一时间发送和接收数据，SPI没有定义速度限制，通常能达到甚至超过10M&#x2F;bps。 SPI有主、从两种模式，通常由一个主模块和一个或多个从模块组成（S">
<meta property="og:type" content="article">
<meta property="og:title" content="SPI">
<meta property="og:url" content="http://mavericreate.top/Blogs/2025/08/28/SPI/index.html">
<meta property="og:site_name" content="Mavericreate.Blog">
<meta property="og:description" content="简介SPI是串行外设接口（Serial Peripheral Interface）的缩写，是美国摩托罗拉公司（Motorola）最先推出的一种同步串行传输规范，也是一种单片机外设芯片串行扩展接口，是一种高速、全双工、同步通信总线，所以可以在同一时间发送和接收数据，SPI没有定义速度限制，通常能达到甚至超过10M&#x2F;bps。 SPI有主、从两种模式，通常由一个主模块和一个或多个从模块组成（S">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20200429141530267.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FzNDgwMTMzOTM3,size_16,color_FFFFFF,t_70">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20200429141618139.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FzNDgwMTMzOTM3,size_16,color_FFFFFF,t_70">
<meta property="og:image" content="https://upload.wikimedia.org/wikipedia/commons/9/97/SPI_three_slaves_daisy_chained.svg">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20200429143110758.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FzNDgwMTMzOTM3,size_16,color_FFFFFF,t_70">
<meta property="og:image" content="https://pic2.zhimg.com/80/v2-1141b7036cf151564818cc6cb676d275_720w.webp">
<meta property="og:image" content="https://pic2.zhimg.com/80/v2-e69e8be0703f70f3e6eb781fa86fee05_720w.webp">
<meta property="article:published_time" content="2025-08-28T07:00:00.000Z">
<meta property="article:modified_time" content="2025-08-28T13:30:31.874Z">
<meta property="article:author" content="唐浩天">
<meta property="article:tag" content="SPI">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://img-blog.csdnimg.cn/20200429141530267.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FzNDgwMTMzOTM3,size_16,color_FFFFFF,t_70">
  
  
  
  <title>SPI - Mavericreate.Blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/Blogs/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/Blogs/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/Blogs/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"mavericreate.top","root":"/Blogs/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/Blogs/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/Blogs/js/utils.js" ></script>
  <script  src="/Blogs/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/Blogs/">
      <strong>Mavericreate.Blogs</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/Blogs/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/Blogs/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/Blogs/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/Blogs/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/Blogs/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/Blogs/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="SPI"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2025-08-28 00:00" pubdate>
          2025年8月28日 凌晨
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          5.1k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          43 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">SPI</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>SPI是串行外设接口（Serial Peripheral Interface）的缩写，是美国摩托罗拉公司（Motorola）最先推出的一种同步串行传输规范，也是一种单片机外设芯片串行扩展接口，是一种高速、全双工、同步通信总线，所以可以在同一时间发送和接收数据，SPI没有定义速度限制，通常能达到甚至超过10M&#x2F;bps。</p>
<p>SPI有主、从两种模式，通常由一个主模块和一个或多个从模块组成（SPI不支持多主机），主模块选择一个从模块进行同步通信，从而完成数据的交换。提供时钟的为主设备（Master），接收时钟的设备为从设备（Slave），SPI接口的读写操作，都是由主设备发起，当存在多个从设备时，通过各自的片选信号进行管理。</p>
<h1 id="通信原理"><a href="#通信原理" class="headerlink" title="通信原理"></a>通信原理</h1><p>SPI主设备和从设备都有一个串行移位寄存器，主设备通过向它的SPI串行寄存器写入一个字节来发起一次传输。</p>
<h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p>SPI通信原理很简单，需要至少4根线，单向传输时3根线，它们是MISO（主设备数据输入）、MOSI（主设备数据输出）、SCLK（时钟）和CS&#x2F;SS（片选）：</p>
<p>MISO（ Master Input Slave Output）：主设备数据输入，从设备数据输出；<br>MOSI（Master Output Slave Input）：主设备数据输出，从设备数据输入；<br>SCLK（Serial Clock）：时钟信号，由主设备产生；<br>CS&#x2F;SS（Chip Select&#x2F;Slave Select）：从设备使能信号，由主设备控制，一主多从时，CS&#x2F;SS是从芯片是否被主芯片选中的控制信号，只有片选信号为预先规定的使能信号时（高电位或低电位），主芯片对此从芯片的操作才有效。</p>
<p>一主设备一从设备模式</p>
<p>一主设备多从设备模式</p>
<h2 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h2><p>1、主设备发起信号，将CS&#x2F;SS拉低，启动通信。</p>
<p>2、主设备通过发送时钟信号，来告诉从设备进行写数据或者读数据操作（采集时机可能是时钟信号的上升沿（从低到高）或下降沿（从高到低），因为SPI有四种模式，后面会讲到），它将立即读取数据线上的信号，这样就得到了一位数据（1bit）。</p>
<p>3、主机（Master）将要发送的数据写到发送数据缓存区（Menory），缓存区经过移位寄存器（缓存长度不一定，看单片机配置），串行移位寄存器通过MOSI信号线将字节一位一位的移出去传送给从机，同时MISO接口接收到的数据经过移位寄存器一位一位的移到接收缓存区。</p>
<p>4、从机（Slave）也将自己的串行移位寄存器（缓存长度不一定，看单片机配置）中的内容通过MISO信号线返回给主机。同时通过MOSI信号线接收主机发送的数据，这样，两个移位寄存器中的内容就被交换。</p>
<p>例如，下图示例中简单模拟SPI通信流程，主机拉低NSS片选信号，启动通信，并且产生时钟信号，上升沿触发边沿信号，主机在MOSI线路一位一位发送数据0X53，在MISO线路一位一位接收数据0X46，如下图所示：</p>
<p>这里有一点需要着重说明一下：SPI只有主模式和从模式之分，没有读和写的说法，外设的写操作和读操作是同步完成的。若只进行写操作，主机只需忽略接收到的字节（虚拟数据）；反之，若主机要读取从机的一个字节，就必须发送一个空字节来引发从机的传输。也就是说，你发一个数据必然会收到一个数据；你要收一个数据必须也要先发一个数据。 </p>
<h1 id="通信特性"><a href="#通信特性" class="headerlink" title="通信特性"></a>通信特性</h1><h2 id="设备选择"><a href="#设备选择" class="headerlink" title="设备选择"></a>设备选择</h2><p>SPI是单主设备（Single Master）通信协议，只有一支主设备能发起通信，当SPI主设备想读&#x2F;写从设备时，它首先拉低从设备对应的SS线（SS是低电平有效）。接着开始发送工作脉冲到时钟线上，在相应的脉冲时间上，主设备把信号发到MOSI实现“写”，同时可对MISO采样而实现“读”。如下图所示：</p>
<h2 id="设备时钟"><a href="#设备时钟" class="headerlink" title="设备时钟"></a>设备时钟</h2><p>SPI时钟特点主要包括：时钟速率、时钟极性和时钟相位三方面。</p>
<h3 id="时钟速率"><a href="#时钟速率" class="headerlink" title="时钟速率"></a>时钟速率</h3><p>SPI总线上的主设备必须在通信开始时候配置并生成相应的时钟信号。从理论上讲，只要实际可行，时钟速率就可以是你想要的任何速率，当然这个速率受限于每个系统能提供多大的系统时钟频率，以及最大的SPI传输速率。</p>
<h3 id="时钟极性"><a href="#时钟极性" class="headerlink" title="时钟极性"></a>时钟极性</h3><p>根据硬件制造商的命名规则不同，时钟极性通常写为CKP或CPOL。时钟极性和相位共同决定读取数据的方式，比如信号上升沿读取数据还是信号下降沿读取数据。</p>
<p>CKP可以配置为1或0。这意味着你可以根据需要将时钟的默认状态（IDLE）设置为高或低。极性反转可以通过简单的逻辑逆变器实现。你必须参考设备的数据手册才能正确设置CKP和CKE。</p>
<p>CKP &#x3D; 0：时钟空闲IDLE为低电平 0；<br>CKP &#x3D; 1：时钟空闲IDLE为高电平1。<br>3.2.3、时钟相位</p>
<p>根据硬件制造商的不同，时钟相位通常写为CKE或CPHA。顾名思义，时钟相位&#x2F;边沿，也就是采集数据时是在时钟信号的具体相位或者边沿；</p>
<p>CKE &#x3D; 0：在时钟信号SCK的第一个跳变沿采样；<br>CKE &#x3D; 1：在时钟信号SCK的第二个跳变沿采样。</p>
<h3 id="四种模式"><a href="#四种模式" class="headerlink" title="四种模式"></a>四种模式</h3><p>根据SPI的时钟极性和时钟相位特性可以设置4种不同的SPI通信操作模式，它们的区别是定义了在时钟脉冲的哪条边沿转换（toggles）输出信号，哪条边沿采样输入信号，还有时钟脉冲的稳定电平值（就是时钟信号无效时是高还是低），详情如下所示：</p>
<p>Mode0：CKP&#x3D;0，CKE &#x3D;0：当空闲态时，SCK处于低电平，数据采样是在第1个边沿，也就是SCK由低电平到高电平的跳变，所以数据采样是在上升沿（准备数据），（发送数据）数据发送是在下降沿。<br>Mode1：CKP&#x3D;0，CKE&#x3D;1：当空闲态时，SCK处于低电平，数据发送是在第2个边沿，也就是SCK由低电平到高电平的跳变，所以数据采样是在下降沿，数据发送是在上升沿。<br>Mode2：CKP&#x3D;1，CKE&#x3D;0：当空闲态时，SCK处于高电平，数据采集是在第1个边沿，也就是SCK由高电平到低电平的跳变，所以数据采集是在下降沿，数据发送是在上升沿。<br>Mode3：CKP&#x3D;1，CKE&#x3D;1：当空闲态时，SCK处于高电平，数据发送是在第2个边沿，也就是SCK由高电平到低电平的跳变，所以数据采集是在上升沿，数据发送是在下降沿。</p>
<p>黑线为采样数据的时刻，蓝线为SCK时钟信号</p>
<p>举个例子，下图是SPI Mode0读&#x2F;写时序，可以看出SCK空闲状态为低电平，主机数据在第一个跳变沿被从机采样，数据输出同理。</p>
<p>下图是SPI Mode3读&#x2F;写时序，SCK空闲状态为高电平，主机数据在第二个跳变沿被从机采样，数据输出同理。</p>
<h1 id="多从机模式"><a href="#多从机模式" class="headerlink" title="多从机模式"></a>多从机模式</h1><p>有两种方法可以将多个从设备连接到主设备：多片选和菊花链。</p>
<p>通常，每个从机都需要一条单独的SS线。如果要和特定的从机进行通讯，可以将相应的NSS信号线拉低，并保持其他SS信号线的状态为高电平；如果同时将两个SS信号线拉低，则可能会出现乱码，因为从机可能都试图在同一条MISO线上传输数据，最终导致接收数据乱码。</p>
<p>菊花链的最大缺点是信号串行传输，一旦数据链路中的某设备发生故障的时候，它下面优先级较低的设备就不可能得到服务了。另一方面，距离主机越远的从机，获得服务的优先级越低，所以需要安排好从机的优先级，并且设置总线检测器，如果某个从机超时，则对该从机进行短路，防止单个从机损坏造成整个链路崩溃的情况。</p>
<h1 id="SPI优缺点"><a href="#SPI优缺点" class="headerlink" title="SPI优缺点"></a>SPI优缺点</h1><h2 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h2><p>无起始位和停止位，因此数据位可以连续传输而不会被中断；<br>没有像I2C这样复杂的从设备寻址系统；<br>数据传输速率比I2C更高（几乎快两倍）；<br>分离的MISO和MOSI信号线，因此可以同时发送和接收数据；<br>极其灵活的数据传输，不限于8位，它可以是任意大小的字；<br>非常简单的硬件结构。从站不需要唯一地址（与I2C不同）。从机使用主机时钟，不需要精密时钟振荡器&#x2F;晶振（与UART不同）。不需要收发器（与CAN不同）。</p>
<h2 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h2><p>使用四根信号线（I2C和UART使用两根信号线）；<br>无法确认是否已成功接收数据（I2C拥有此功能）；<br>没有任何形式的错误检查，如UART中的奇偶校验位；<br>只允许一个主设备；<br>没有硬件从机应答信号（主机可能在不知情的情况下无处发送）；<br>没有定义硬件级别的错误检查协议；<br>与RS-232和CAN总线相比，只能支持非常短的距离；</p>
<p>————————————————<br>版权声明：本文为CSDN博主「不脱发的程序猿」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。<br>原文链接：<a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_38106923/article/details/124364676">https://blog.csdn.net/m0_38106923/article/details/124364676</a></p>
<h1 id="SPI（Serial-Peripheral-interface）"><a href="#SPI（Serial-Peripheral-interface）" class="headerlink" title="SPI（Serial Peripheral interface）"></a>SPI（Serial Peripheral interface）</h1><h2 id="Intro"><a href="#Intro" class="headerlink" title="Intro"></a>Intro</h2><h3 id="Definatipn"><a href="#Definatipn" class="headerlink" title="Definatipn"></a>Definatipn</h3><p>SPI 是英语Serial Peripheral interface的缩写，顾名思义就是串行外围设备接口。是Motorola(摩托罗拉)首先在其MC68HCXX系列处理器上定义的。</p>
<p>SPI，是一种<strong>高速的，全双工，同步的通信总线</strong>，并且在芯片的管脚上<strong>只占用四根线</strong>，节约了芯片的管脚，同时为PCB的布局上节省空间，提供方便，主要应用在 EEPROM，FLASH，实时时钟，AD转换器，还有数字信号处理器和数字信号解码器之间。</p>
<p>特别之处：数据能在没有中断的情况下传输（transport without interruption）</p>
<p>The Serial Peripheral Interface Bus or SPI bus is <strong>a synchronous serial data link standard（同步串行数据链路标准）</strong> named by Motorola that operates in Full duplex mode.</p>
<p>Devices communicate in master&#x2F;slave mode where the master device initiates the data frame. <strong>Multiple slave devices are allowed with individual slave select (chip select) lines</strong>.</p>
<p>During a data transfer the master always sends <strong>8 to 16 bits of data to the slave</strong>, and the slave always sends <strong>a byte of data to the master</strong>.</p>
<h3 id="Function"><a href="#Function" class="headerlink" title="Function"></a>Function</h3><p>SPI is a common communication protocol used by many different devices. For example, <strong>SD card reader modules, RFID card reader modules, and 2.4 GHz wireless transmitter&#x2F;receivers</strong> all use SPI to communicate with microcontrollers.</p>
<p>One <strong>unique benefit</strong> of SPI is the fact that <strong>data can be transferred without interruption</strong>.</p>
<p><strong>Any number of bits</strong> can be sent or received <strong>in a continuous stream</strong>.</p>
<p>With I2C and UART, data is sent in packets, limited to a specific number of bits. Start and stop conditions define the beginning and end of each packet</p>
<h3 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h3><p>Peripheral devices in embedded systems &#x3D;&gt; parallel address and data bus &#x3D;&gt; lots of wiring and requires number of pins &#x3D;&gt; additional decoding logic required.</p>
<p><strong>To reduce the pins and wiring</strong> &#x3D;&gt; cost &#x3D;&gt; Serial bus protocol &#x3D;&gt; SPI (4-wire) &amp; I2C (2-wire).</p>
<p>Penalty &#x3D;&gt; Slower communication</p>
<h2 id="Principle"><a href="#Principle" class="headerlink" title="Principle"></a>Principle</h2><h3 id="SPI主从模式"><a href="#SPI主从模式" class="headerlink" title="SPI主从模式"></a>SPI主从模式</h3><p>SPI<strong>分为主、从两种模式</strong>，一个SPI通讯系统<strong>需要包含一个（且只能是一个）主设备，一个或多个从设备</strong>。提供时钟的为主设备（Master），接收时钟的设备为从设备（Slave），SPI接口的读写操作，都是由主设备发起。当存在多个从设备时，通过各自的片选信号进行管理。</p>
<p>SPI是全双工且SP<strong>I没有定义速度限制</strong>，一般的实现通常能达到甚至超过10 Mbps</p>
<p>硬件上为4根线。</p>
<h3 id="移位寄存器"><a href="#移位寄存器" class="headerlink" title="移位寄存器"></a>移位寄存器</h3><p>具有寄存数据功能的逻辑电路称为寄存器。移位寄存器是指寄存器中所存的代码能够在移位脉冲的作用下依次左移或右移。</p>
<p>根据存取信息的方式不同，移位寄存器可分为：串入串出、串入并出、并入串出、并入并出四种形式。</p>
<p>The master and slave both contain shift registers, and the SPI bus connects them together to make one long, distributed shift register.</p>
<p>In operation, data to be sent is loaded into the master shift register (for a write) or the slave shift register (for a read), and the SPI controller issues enough clock pulses to shift all data bits out of one shift register and into the other. Typically, the MSB is shifted out first.</p>
<p>Because the SPI bus creates one long shift register that is partly in the master and partly in the slave, <strong>data is rotated through both devices</strong>.</p>
<p><strong>To read data from an SPI device, you must shift data out of the slave and in to the master</strong>, and at the same time shift data out of the master and in to the slave - even if there is no useful data to send to the slave.In fact it is often the case that an SPI-connected device (like a sensor) produces, but does not consume data - in this case, MOSI data is irrelevant (a don’t care), and either 1’s or 0’s can be shifted. At any point, the master or slave can overwrite data in their local shift registers. It is possible to use a <strong>daisy-chain arrangement</strong> to make one long shift register.</p>
<h3 id="SPI信号线"><a href="#SPI信号线" class="headerlink" title="SPI信号线"></a>SPI信号线</h3><p>SPI接口一般使用四条信号线通信：<br>SDI（数据输入），SDO（数据输出），SCK（时钟），CS（片选）</p>
<h4 id="MISO"><a href="#MISO" class="headerlink" title="MISO"></a>MISO</h4><p>主设备输入&#x2F;从设备输出引脚。该引脚在从模式下发送数据，在主模式下接收数据。</p>
<h4 id="MOSI"><a href="#MOSI" class="headerlink" title="MOSI"></a>MOSI</h4><p> 主设备输出&#x2F;从设备输入引脚。该引脚在主模式下发送数据，在从模式下接收数据。</p>
<h4 id="SCLK"><a href="#SCLK" class="headerlink" title="SCLK"></a>SCLK</h4><p>串行时钟信号，由主设备产生。</p>
<p>The SPI used clock signal to synchronize the transfer of data across the SPI interface.</p>
<p>The SCK is always driven by the master and received by the slave, The clock is programmable to be active <em>high or active low</em>.</p>
<p>The SCK is only active during a data transfer. Any other time, it is in its inactive state.</p>
<ul>
<li>The SPI used clock signal to <strong>synchronize</strong> the transfer of data across the SPI interface.</li>
<li>The SCK is <strong>always driven by the master</strong> and received by the slave, The clock is <strong>programmable</strong> to be active <em>high or active low</em>.</li>
</ul>
<h4 id="CS-SS-Slave-signal"><a href="#CS-SS-Slave-signal" class="headerlink" title="CS&#x2F;SS(Slave signal)"></a>CS&#x2F;SS(Slave signal)</h4><p>从设备片选信号，由主设备控制。它的功能是用来作为“片选引脚”，也就是选择指定的从设备，让主设备可以单独地与特定从设备通讯，避免数据线上的冲突。</p>
<p>Pin Name : SS </p>
<p>Type <strong>:</strong> <strong>Input</strong></p>
<p>The SPI slave select signal is an active low signal that indicates which <strong>slave</strong> is currently selected to participate in a data transfer.</p>
<p>Each slave has its own unique slave select signal input.</p>
<p>The SS must be <strong>low</strong> before data transactions begin and normally stays low for the duration of the transaction.</p>
<p>If the SS signal goes high any time during a data transfer, the transfer is considered to be aborted.</p>
<h3 id="连接方式"><a href="#连接方式" class="headerlink" title="连接方式"></a>连接方式</h3><p>SPI一对一</p>
<p><img src="https://img-blog.csdnimg.cn/20200429141530267.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FzNDgwMTMzOTM3,size_16,color_FFFFFF,t_70" srcset="/Blogs/img/loading.gif" lazyload></p>
<p>SPI一对多</p>
<p><img src="https://img-blog.csdnimg.cn/20200429141618139.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FzNDgwMTMzOTM3,size_16,color_FFFFFF,t_70" srcset="/Blogs/img/loading.gif" lazyload></p>
<p>Daisy-chained SPI bus</p>
<p>If only <strong>one</strong> slave select pin is available, the slaves can be daisy-chained like this</p>
<p><img src="https://upload.wikimedia.org/wikipedia/commons/9/97/SPI_three_slaves_daisy_chained.svg" srcset="/Blogs/img/loading.gif" lazyload></p>
<h3 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h3><h4 id="SPI设备选择"><a href="#SPI设备选择" class="headerlink" title="SPI设备选择"></a>SPI设备选择</h4><p>SPI是<strong>单主设备（ single-master)通信协议</strong>，这意味着总线中的只有一支中心设备能发起通信。当SPI主设备想读&#x2F;写［从设备］时，它<strong>首先拉低［从设备］对应的SS线</strong>（SS是低电平有效），接着开始发送工作脉冲到时钟线上，在相应的脉冲时间上，［<strong>主设备］把信号发到MOSI实现“写”</strong>，同时可对<strong>MISO采样而实现“读”</strong></p>
<h2 id="Steps"><a href="#Steps" class="headerlink" title="Steps"></a>Steps</h2><h3 id="SPI数据发送接收"><a href="#SPI数据发送接收" class="headerlink" title="SPI数据发送接收"></a>SPI数据发送接收</h3><p>SPI主机和从机都有一个串行<strong>移位寄存器</strong>，主机通过向它的SPI串行寄存器写入一个字节来发起一次传输。</p>
<ol>
<li>首先拉低对应SS信号线，表示与该设备进行通信。The master outputs the clock signal</li>
<li>主机通过发送SCLK时钟信号，来告诉从机写数据或者读数据。（这里要注意，SCLK时钟信号可能是低电平有效，也可能是高电平有效，因为SPI有四种模式，这个我们在下面会介绍The master switches the SS&#x2F;CS pin to a low voltage state, which activates the slave(<strong>注意ppt这里第一步和第二步与网站资料不一样</strong>)</li>
<li>主机(Master)将要发送的数据写到发送数据缓存区(Menory)，缓存区经过移位寄存器(0~7)，串行移位寄存器通过MOSI信号线将字节一位一位的移出去传送给从机，，同时MISO接口接收到的数据经过移位寄存器一位一位的移到接收缓存区。The master sends the data one bit at a time to the slave along the MOSI line. The slave reads the bits as they are received</li>
<li>从机(Slave)也将自己的串行移位寄存器(0~7)中的内容通过MISO信号线返回给主机。同时通过MOSI信号线接收主机发送的数据，这样，两个移位寄存器中的内容就被交换。If a response is needed, the slave returns data one bit at a time to the master along the MISO line. The master reads the bits as they are received :</li>
</ol>
<p><img src="https://img-blog.csdnimg.cn/20200429143110758.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FzNDgwMTMzOTM3,size_16,color_FFFFFF,t_70" srcset="/Blogs/img/loading.gif" lazyload></p>
<p>SPI<strong>只有主模式和从模式之分，没有读和写的说法</strong>，外设的写操作和读操作是同步完成的。</p>
<p>如果只进行写操作，主机只需忽略接收到的字节；反之，若主机要读取从机的一个字节，就必须发送一个空字节来引发从机的传输。也就是说，你发一个数据必然会收到一个数据；你要收一个数据必须也要先发一个数据。</p>
<h3 id="SPI通信的四种模式"><a href="#SPI通信的四种模式" class="headerlink" title="SPI通信的四种模式"></a>SPI通信的四种模式</h3><blockquote>
<p> SPI的四种模式，简单地讲就是设置SCLK时钟信号线的那种信号为有效信号</p>
</blockquote>
<p>SPI通信有4种不同的操作模式，<strong>不同的从设备可能在出厂是就是配置为某种模式</strong>，这是不能改变的；但我们的通信双方必须是工作在同一模式下，所以我们可以对我们的主设备的SPI模式进行配置，通过CPOL（时钟极性）和CPHA（时钟相位）来控制我们主设备的通信模式，具体如下：</p>
<ul>
<li>时钟极性(CPOL)定义了时钟空闲状态电平：</li>
</ul>
<p>CPOL&#x3D;0，表示当SCLK&#x3D;0时处于空闲态，所以有效状态就是SCLK处于高电平时<br>CPOL&#x3D;1，表示当SCLK&#x3D;1时处于空闲态，所以有效状态就是SCLK处于低电平时</p>
<ul>
<li>时钟相位(CPHA)定义数据的采集时间。</li>
</ul>
<p>CPHA&#x3D;0，在时钟的第一个跳变沿（上升沿或下降沿）进行数据采样。，在第2个边沿发送数据<br>CPHA&#x3D;1，在时钟的第二个跳变沿（上升沿或下降沿）进行数据采样。，在第1个边沿发送数据</p>
<p>例如：</p>
<p>Mode0：CPOL&#x3D;0，CPHA&#x3D;0：此时空闲态时，SCLK处于低电平，数据采样是在第1个边沿，也就是SCLK由低电平到高电平的跳变，所以数据采样是在上升沿(准备数据），（发送数据）数据发送是在下降沿。</p>
<p>Mode1：CPOL&#x3D;0，CPHA&#x3D;1：此时空闲态时，SCLK处于低电平，数据发送是在第1个边沿，也就是SCLK由低电平到高电平的跳变，所以数据采样是在下降沿，数据发送是在上升沿。</p>
<p>Mode2：CPOL&#x3D;1，CPHA&#x3D;0：此时空闲态时，SCLK处于高电平，数据采集是在第1个边沿，也就是SCLK由高电平到低电平的跳变，所以数据采集是在下降沿，数据发送是在上升沿。</p>
<p>Mode3：CPOL&#x3D;1，CPHA&#x3D;1：此时空闲态时，SCLK处于高电平，数据发送是在第1个边沿，也就是SCLK由高电平到低电平的跳变，所以数据采集是在上升沿，数据发送是在下降沿。</p>
<p>它们的区别是定义了在时钟脉冲的哪条边沿转换（toggles）输出信号，哪条边沿采样输入信号，还有时钟脉冲的稳定电平值（就是时钟信号无效时是高还是低）。每种模式由一对参数刻画，它们称为时钟极（clock polarity）CPOL与时钟期（clock phase）CPHA</p>
<h3 id="三种工作模式"><a href="#三种工作模式" class="headerlink" title="三种工作模式"></a>三种工作模式</h3><p>SPI工作在3中模式下，分别是运行、等待和停止。</p>
<p>运行模式（Run Mode）</p>
<ul>
<li>这是基本的操作模式</li>
</ul>
<p>等待模式（Wait Mode）</p>
<ul>
<li>SPI工作在等待模式是一种可配置的低功耗模式，可以通过SPICR2寄存器的SPISWAI位进行控制。在等待模式下，如果SPISWAI位清0，SPI操作类似于运行模式。如果SPISWAI位置1，SPI进入低功耗状态，并且SPI时钟将关闭。如果SPI配置为主机，所有的传输将停止，但是会在CPU进入运行模式后重新开始。如果SPI配置为从机，会继续接收和传输一个字节，这样就保证从机与主机同步。</li>
</ul>
<p>停止模式（Stop Mode）</p>
<ul>
<li>为了降低功耗，SPI在停止模式是不活跃的。如果SPI配置为主机，正在进行的传输会停止，但是在CPU进入运行模式后会重新开始。如果SPI配置为从机，会继续接受和发送一个字节，这样就保证了从机与主机同步。</li>
</ul>
<h3 id="Clock-Polarity-and-Phase"><a href="#Clock-Polarity-and-Phase" class="headerlink" title="Clock Polarity and Phase"></a>Clock Polarity and Phase</h3><p>In addition to setting the clock frequency, the <strong>master</strong> must also configure the <strong>clock</strong> with respect to the <strong>data</strong>.</p>
<p>These two options are: </p>
<ul>
<li>clock polarity (CPOL) </li>
<li>clock phase (CPHA)</li>
</ul>
<p>The clock signal in SPI can be modified using the properties of <strong>clock polarity</strong> <strong>and</strong> <strong>clock phase</strong>. These two properties work together to define when the <em>bits are output and when they are sampled</em>.</p>
<ul>
<li><strong>Clock polarity</strong> can be set by the master to allow for bits to be output and sampled on either the rising or falling edge of the clock cycle.</li>
<li><strong>Clock phase</strong> can be set for output and sampling to occur on either the <em>first edge or second edge of the clock cycle</em>, regardless of whether it is rising or falling</li>
</ul>
<p>SPI串行同步时钟可以设置为不同的极性（Clock Polarity ，CPOL）与相位（Clock Phase ，CPHA）。</p>
<p>时钟的极性（CPOL）用来<strong>决定在总线空闲时，同步时钟（SCK）信号线上的电位是高电平还是低电平</strong>。当时钟极性为0时（CPOL&#x3D;0），SCK信号线在空闲时为低电平；当时钟极性为1时（CPOL&#x3D;1），SCK信号线在空闲时为高电平；</p>
<p>时钟的相位（CPHA）用来<strong>决定何时进行信号采样</strong>。</p>
<p>当时钟相位为1时（CPHA&#x3D;1），在SCK信号线的第二个跳变沿进行采样；这里的跳变沿究竟是上升沿还是下降沿？取决于时钟的极性。当时钟<strong>极性为0时，取下降沿</strong>；当时钟极性为1时，取上升沿；如下图：</p>
<p><img src="https://pic2.zhimg.com/80/v2-1141b7036cf151564818cc6cb676d275_720w.webp" srcset="/Blogs/img/loading.gif" lazyload alt="img"></p>
<p>当时钟相位为0时（CPHA&#x3D;0），在SCK信号线的第一个跳变沿进行采样。跳变沿同样与时钟极性有关：当时钟<strong>极性为0时，取上升沿</strong>；当时钟极性为1时，取下降沿；如下图： </p>
<p><img src="https://pic2.zhimg.com/80/v2-e69e8be0703f70f3e6eb781fa86fee05_720w.webp" srcset="/Blogs/img/loading.gif" lazyload alt="img"></p>
<h2 id="Pros-Cons"><a href="#Pros-Cons" class="headerlink" title="Pros &amp; Cons"></a>Pros &amp; Cons</h2><h3 id="Advantages"><a href="#Advantages" class="headerlink" title="Advantages"></a>Advantages</h3><ul>
<li><p>Full duplex communication </p>
</li>
<li><p>Higher throughput than I2C</p>
</li>
<li><p>Complete protocol flexibility for the bits transferred</p>
<ul>
<li><p>Not limited to 8-bit words</p>
</li>
<li><p>Arbitrary choice of message size, content, &amp; purpose</p>
</li>
</ul>
</li>
<li><p>No start and stop bits, so the data can be streamed continuously without interruption</p>
</li>
<li><p>No complicated slave addressing system like I2C</p>
</li>
<li><p>Higher data transfer rate than I2C (almost twice as fast)</p>
</li>
<li><p>Separate MISO and MOSI lines, so data can be sent and received at the same time</p>
</li>
</ul>
<p>* Typically lower power requirements than I2C due to less circuitry</p>
<p>No arbitration or associated failure modes * Slaves use the master’s clock, and don’t need precision oscillators</p>
<h3 id="Disadvantage"><a href="#Disadvantage" class="headerlink" title="Disadvantage"></a>Disadvantage</h3><ul>
<li>Uses four wires (I2C and UARTs use two)</li>
<li>No acknowledgement that the data has been successfully received (I2C has this)</li>
</ul>
<ul>
<li>No form of error checking like the parity bit in UART</li>
<li>Only allows for a single master</li>
</ul>
<h3 id="Application"><a href="#Application" class="headerlink" title="Application"></a>Application</h3><p>SPI is used to talk to a variety of peripherals, such as:</p>
<p><strong>Sensors:</strong> Temperature, pressure, ADC, touch-screens <strong>Control devices</strong>: audio codecs, digital potentiometers, DAC Real-time clocks, LCD displays, sometimes even for managing image data, Any SD card</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/as480133937/article/details/105764119">https://blog.csdn.net/as480133937/article/details/105764119</a></p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/Blogs/categories/%E5%BE%AE%E7%94%B5%E5%AD%90%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/" class="category-chain-item">微电子知识体系</a>
  
  
    <span>></span>
    
  <a href="/Blogs/categories/%E5%BE%AE%E7%94%B5%E5%AD%90%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/MS/" class="category-chain-item">MS</a>
  
  

  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/Blogs/tags/SPI/" class="print-no-link">#SPI</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>SPI</div>
      <div>http://mavericreate.top/Blogs/2025/08/28/SPI/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>唐浩天</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2025年8月28日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/Blogs/2025/08/28/Python%E8%BF%9B%E9%98%B6/" title="Python进阶">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Python进阶</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/Blogs/2025/08/28/STM32/" title="STM32">
                        <span class="hidden-mobile">STM32</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/Blogs/js/events.js" ></script>
<script  src="/Blogs/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/Blogs/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/Blogs/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/Blogs/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
